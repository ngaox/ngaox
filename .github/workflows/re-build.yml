name: '[RE] 🛠️ Build'
on:
  workflow_call:
    inputs:
      artifacts-key:
        required: true
        type: string
      tag_name:
        required: true
        type: string
jobs:
  artifacts:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
        with:
          ref: 'main'
      - uses: actions/setup-node@v2
        with:
          node-version: '16'
          cache: 'yarn'
      - run: yarn --frozen-lockfile
      - name: 🛠 Build everything
        run: yarn nx-all build
      - name: 📦 Zip packages
        run: |
          mkdir -p dist/artifacts
          cd dist/packages
          for package in */; do
            zip -r ../artifacts/ngaox-$(basename $package)-${{ inputs.tag_name }}.zip $package;
          done
      - uses: actions/upload-artifact@v2
        with:
          name: ${{ inputs.artifacts-key }}
          path: dist
